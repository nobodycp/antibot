{% extends "base.html" %}

{% block title %}Uploaded ZIP Files{% endblock %}

{% block content %}
<div class="text-sm text-white px-4">
  <h1 class="text-base font-semibold mb-4 border-b border-zinc-700 pb-1 flex items-center justify-between">
    <span>ðŸ“¦ Uploaded ZIP Files</span>
    <span class="text-xs font-normal text-zinc-400">Total: {{ files|length }}</span>
  </h1>
  {% include "partials/messages.html" %}
  <!-- Search Field -->
  <div class="mb-6 w-full md:w-auto">
    <input type="text" placeholder="Search files..." onkeyup="filterFiles(this)"
           class="px-3 py-1.5 bg-zinc-800 border border-zinc-600 rounded text-xs text-white w-full md:max-w-xs focus:outline-none focus:ring-1 focus:ring-purple-500" />
  </div>
  <!-- Upload Form -->
  <form method="post" enctype="multipart/form-data" action="{% url 'tools:uploader_files' %}" class="mt-6 w-full md:w-auto">
    {% csrf_token %}
    <div class="bg-zinc-800 border border-zinc-600 rounded-md p-4 flex flex-col md:flex-row items-center gap-3 w-full">
      <input type="text" name="name" placeholder="File Label (e.g., Log Backup)" required
             class="flex-1 px-3 py-1.5 bg-zinc-900 text-white border border-zinc-700 rounded text-xs focus:outline-none focus:ring-1 focus:ring-blue-500" />

      <label class="cursor-pointer flex items-center gap-2 text-blue-400 hover:text-blue-500 text-xs">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1M12 12v9m0 0l3-3m-3 3l-3-3m6-6V5a2 2 0 00-2-2H9a2 2 0 00-2 2v6" />
        </svg>
        <span>Choose ZIP</span>
        <input type="file" name="zip_file" required class="hidden" onchange="updateFileName(this)">
      </label>

      <span id="selected-file" class="text-xs text-zinc-400 truncate w-full md:w-auto"></span>

      <button type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-1.5 rounded text-xs whitespace-nowrap">
        Upload File
      </button>
    </div>
  </form>
  <!-- File List Table -->
<div class="mt-8 rounded overflow-hidden border border-zinc-700">
    <table id="file-table" class="w-full bg-zinc-800 text-xs">
      <thead class="bg-zinc-700 text-left text-zinc-300 uppercase tracking-wide">
        <tr>
          <th class="px-3 py-2">Name</th>
          <th class="px-3 py-2">File</th>
          <th class="px-3 py-2 text-right">Uploaded</th>
          <th class="px-3 py-2 text-right">Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for file in files %}
        <tr class="border-b border-zinc-700 hover:bg-zinc-700/30">
          <td class="px-3 py-1.5 text-zinc-100 font-mono">{{ file.name }}</td>
          <td class="px-3 py-1.5 text-zinc-100">
            <a href="{{ file.zip_file.url }}" class="text-blue-400 hover:underline" download>{{ file.zip_file.name }}</a>
          </td>
          <td class="px-3 py-1.5 text-right text-zinc-400">{{ file.uploaded_at|date:"Y-m-d H:i" }}</td>
          <td class="px-3 py-1.5 text-right">
            <form method="post" action="{% url 'tools:uploader_files' %}" class="inline">
              {% csrf_token %}
              <input type="hidden" name="delete_id" value="{{ file.id }}">
              <button type="submit" class="text-red-500 hover:text-red-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2H9a2 2 0 00-2 2h10z" />
                </svg>
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="px-3 py-4 text-zinc-400 text-center">No files uploaded yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>


</div>

<script>
function filterFiles(input) {
  const filter = input.value.toLowerCase();
  const rows = document.querySelectorAll("#file-table tbody tr");
  rows.forEach(row => {
    const name = row.querySelector("td").textContent.toLowerCase();
    row.style.display = name.includes(filter) ? "" : "none";
  });
}

function updateFileName(input) {
  const fileName = input.files[0]?.name || "";
  document.getElementById("selected-file").textContent = fileName;
}
</script>
{% endblock %}
