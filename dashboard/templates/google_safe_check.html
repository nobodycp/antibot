{% extends "base.html" %}

{% block title %}Google Safe Check{% endblock %}

{% block content %}
<div class="w-full px-6 text-sm">
  <h1 class="text-base font-semibold mb-4 text-white border-b border-zinc-700 pb-1 flex items-center justify-between">
    <span>ðŸ”Ž Google Safe Check</span>
    <span class="text-xs font-normal text-zinc-400">Total: {{ links|length }}</span>
  </h1>

  <!-- Controls -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4">
    <div class="flex items-center gap-2">
      <!-- Add Link Form -->
      <form method="post" class="flex flex-wrap items-center gap-2">
        {% csrf_token %}
        <input type="url" name="url" placeholder="Enter website URL"
               class="px-3 py-1 bg-zinc-800 border border-zinc-600 rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-500" required />
        <button type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs">Add</button>
      </form>

      <!-- Refresh Button -->
      <div class="relative group">
        <a href="" class="text-blue-400 hover:text-blue-600">
          <svg title="Refresh" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v6h6M20 20v-6h-6M4 20l16-16" />
          </svg>
        </a>
      </div>
    </div>

    <!-- Search -->
    <input type="text" placeholder="Search URL..." onkeyup="filterLinks(this)"
           class="px-3 py-1 bg-zinc-800 border border-zinc-600 rounded text-xs text-white w-full md:max-w-xs focus:outline-none focus:ring-1 focus:ring-purple-500" />
  </div>

  {% include "partials/messages.html" %}

  <!-- hidden csrf for HTMX -->
  <form style="display: none;">{% csrf_token %}</form>

  <!-- Table -->
  <div class="rounded overflow-hidden border border-zinc-700">
    <table class="w-full bg-zinc-800 text-xs">
      <thead class="bg-zinc-700 text-left text-zinc-300 uppercase tracking-wide">
        <tr>
          <th class="px-3 py-2">URL</th>
          <th class="px-3 py-2">Status</th>
          <th class="px-3 py-2">Last Checked</th>
          <th class="px-3 py-2 text-right">Delete</th>
        </tr>
      </thead>
      <tbody id="safe-check-table"
             hx-get="{% url 'tools:google_safe_check_table' %}"
             hx-trigger="load,every 600s"
             hx-swap="outerHTML">
        <tr><td colspan="4" class="text-center text-zinc-400 py-3">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- JavaScript -->
<script>
function filterLinks(input) {
  const filter = input.value.toLowerCase();
  const rows = document.querySelectorAll("#safe-check-table tr");
  rows.forEach(row => {
    const url = row.querySelector("td").textContent.toLowerCase();
    row.style.display = url.includes(filter) ? "" : "none";
  });
}

document.addEventListener('DOMContentLoaded', function () {
  setTimeout(() => {
    const msgBox = document.getElementById("htmx-messages");
    if (msgBox) msgBox.innerHTML = '';
  }, 3000);
});

document.body.addEventListener('htmx:configRequest', function (event) {
  const tokenInput = document.querySelector('input[name=csrfmiddlewaretoken]');
  if (tokenInput) {
    event.detail.headers['X-CSRFToken'] = tokenInput.value;
  }
});
</script>
{% endblock %}
