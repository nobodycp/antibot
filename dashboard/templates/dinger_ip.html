{% extends "base.html" %}

{% block title %}Dinger IPs{% endblock %}

{% block content %}
<div class="w-full px-6 text-sm">
  <h1 class="text-base font-semibold mb-4 text-white border-b border-zinc-700 pb-1 flex items-center justify-between">
    <span>ðŸ’¥ Dinger IPs List</span>
    <span class="text-xs font-normal text-zinc-400">Total: {{ dingers|length }}</span>
  </h1>

  {% if messages %}
    <div class="space-y-2 mb-4">
      {% for message in messages %}
        <div class="px-3 py-1.5 rounded-md text-xs {{ message.tags }}
                    {% if message.tags == 'success' %}bg-green-600 text-white
                    {% elif message.tags == 'warning' %}bg-yellow-600 text-white
                    {% elif message.tags == 'error' %}bg-red-600 text-white
                    {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <input type="text" placeholder="Search IP..." onkeyup="filterIPs(this)"
         class="mb-4 px-3 py-1 bg-zinc-800 border border-zinc-600 rounded text-xs text-white w-full md:max-w-xs focus:outline-none focus:ring-1 focus:ring-purple-500" />

  <div class="rounded overflow-hidden border border-zinc-700">
    <table id="ip-table" class="w-full bg-zinc-800 text-xs">
      <thead class="bg-zinc-700 text-left text-zinc-300 uppercase tracking-wide">
        <tr>
          <th class="px-3 py-2">IP Address</th>
          <th class="px-3 py-2">Visits</th>
          <th class="px-3 py-2">Last Seen</th>
          <th class="px-3 py-2 text-right">Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for item in dingers %}
        <tr class="border-b border-zinc-700 hover:bg-zinc-700/30">
          <td class="px-3 py-1.5 text-zinc-200 font-mono text-xs">{{ item.ip_address }}</td>
          <td class="px-3 py-1.5 text-zinc-300">{{ item.count }}</td>
          <td class="px-3 py-1.5 text-zinc-400">{{ item.last_seen|date:"Y-m-d H:i" }}</td>
          <td class="px-3 py-1.5 text-right">
            <form method="post" class="inline">
              {% csrf_token %}
              <input type="hidden" name="delete_ip" value="{{ item.ip_address }}">
              <button type="submit" class="text-red-500 hover:text-red-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2H9a2 2 0 00-2 2h10z" />
                </svg>
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="px-3 py-4 text-zinc-400 text-center">No Dinger IPs yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function filterIPs(input) {
  const filter = input.value.toLowerCase();
  const rows = document.querySelectorAll("#ip-table tbody tr");
  rows.forEach(row => {
    const cell = row.querySelector("td");
    if (cell) {
      row.style.display = cell.textContent.toLowerCase().includes(filter) ? "" : "none";
    }
  });
}
</script>
{% endblock %}
