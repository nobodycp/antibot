{% load slugify_filters %}

{% if messages %}
  <div class="space-y-2 mb-4">
    {% for message in messages %}
      <div class="px-3 py-1.5 rounded-md text-xs {{ message.tags }}
                  {% if message.tags == 'success' %}bg-green-600 text-white
                  {% elif message.tags == 'warning' %}bg-yellow-600 text-white
                  {% elif message.tags == 'error' %}bg-red-600 text-white
                  {% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<table class="w-full bg-zinc-800 text-xs">
  <thead class="bg-zinc-700 text-left text-zinc-300 uppercase tracking-wide">
    <tr>
      <th class="px-3 py-2">Time</th>
      <th class="px-3 py-2">IP</th>
      <th class="px-3 py-2">ISP</th>
      <th class="px-3 py-2">Hostname</th>
      <th class="px-3 py-2">OS</th>
      <th class="px-3 py-2">Browser</th>
      <th class="px-3 py-2">Country</th>
      <th class="px-3 py-2 text-right">Delete</th>
    </tr>
  </thead>
  <tbody id="logs-table">
    {% for log in logs %}
    <tr class="border-b border-zinc-700 hover:bg-zinc-700/30">
      <td class="px-3 py-1.5 text-zinc-400">{{ log.timestamp|timesince }} ago</td>
      <td class="px-3 py-1.5 text-zinc-100 font-mono">{{ log.ip_address }}</td>
      <td class="px-3 py-1.5 text-zinc-100">{{ log.isp }}</td>
      <td class="px-3 py-1.5 text-zinc-100">{{ log.hostname }}</td>
      <td class="px-3 py-1.5 text-zinc-100">
        <span class="flex items-center gap-2">
          <img src="/static/icons/os/{{ log.os|icon_name }}.svg" alt="os icon" class="w-4 h-4 inline-block align-middle" />
          <span class="align-middle">{{ log.os }}</span>
        </span>
      </td>
      <td class="px-3 py-1.5 text-zinc-100">
        <span class="flex items-center gap-2">
          <img src="/static/icons/browsers/{{ log.browser|icon_name }}.svg" alt="browser icon" class="w-4 h-4 inline-block align-middle" />
          <span class="align-middle">{{ log.browser }}</span>
        </span>
      </td>
      <td class="px-3 py-1.5 text-zinc-100 flex items-center gap-2">
        {% if log.country %}
          <img src="https://flagcdn.com/24x18/{{ log.country|lower }}.png" alt="{{ log.country }} flag" class="w-4 h-3 rounded-sm border border-zinc-600" />
        {% endif %}
        <span>{{ log.country }}</span>
      </td>
      <td class="px-3 py-1.5 text-right">
        <form hx-post="{% url 'dashboard:delete_log' log.id %}"
              hx-target="#logs-table"
              hx-swap="innerHTML">
          {% csrf_token %}
          <button type="submit" class="text-red-500 hover:text-red-700" title="Delete">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2H9a2 2 0 00-2 2h10z" />
            </svg>
          </button>
        </form>
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="8" class="px-3 py-4 text-zinc-400 text-center">No allowed logs found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
