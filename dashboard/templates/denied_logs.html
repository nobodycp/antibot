{% extends "base.html" %}
{% load slugify_filters %}

{% block title %}Denied Logs{% endblock %}

{% block content %}
<div class="w-full px-6 text-sm">
  <h1 class="text-base font-semibold mb-4 text-white border-b border-zinc-700 pb-1 flex items-center justify-between">
    <span>⛔ Denied Logs</span>
    <span class="text-xs font-normal text-zinc-400">
      {% if page_obj %}
        Showing {{ page_obj.start_index }} - {{ page_obj.end_index }} of {{ page_obj.paginator.count }}
      {% else %}
        Total: {{ logs|length }}
      {% endif %}
    </span>
  </h1>

  <!-- Controls -->
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4">
  <div class="flex flex-wrap items-center gap-2">

    <!-- Delete All -->
    <form method="post" hx-post="{% url 'tracker:denied_logs' %}" hx-target="#denied-logs-wrapper" hx-swap="outerHTML">
      {% csrf_token %}
      <input type="hidden" name="delete_all" value="1">
      <button type="submit" class="text-red-500 hover:text-red-700">
        <!-- أيقونة الحذف -->
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 00-2-2H9a2 2 0 00-2 2h10z" />
        </svg>
      </button>
    </form>

    <!-- Refresh -->
    <a href="#" hx-get="{% url 'tracker:denied_logs_partial' %}" hx-target="#denied-logs-wrapper" hx-swap="outerHTML" class="text-blue-400 hover:text-blue-600">
      <svg title="Refresh" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none"
           viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v6h6M20 20v-6h-6M4 20l16-16" />
      </svg>
    </a>

    <!-- Add Block Rule -->
    <form method="post" class="flex flex-wrap items-center gap-2"
          hx-post="{% url 'tracker:add_block_rule' %}"
          hx-target="#htmx-messages"
          hx-swap="innerHTML">
      {% csrf_token %}
      <select name="block_type" required
              class="px-2 py-1 bg-zinc-800 border border-zinc-600 rounded text-xs text-white">
        <option value="ip" selected>IP Address</option>
        <option value="isp">ISP</option>
<!--        <option value="hostname">Hostname</option>-->
        <option value="os">Operating System</option>
        <option value="browser">Browser</option>
        <option value="subnet">Subnet</option>
      </select>

      <input type="text" name="block_value" required placeholder="Enter value"
             class="px-2 py-1 bg-zinc-800 border border-zinc-600 rounded text-xs text-white w-40" />

      <button type="submit"
              class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs">Add</button>
    </form>
  </div>

  <!-- Search -->
  <form method="get" class="w-full md:max-w-xs ml-auto">
    <input type="text" name="q" placeholder="Search denied logs..."
       hx-get="{% url 'tracker:denied_logs_partial' %}"
       hx-trigger="keyup changed delay:300ms"
       hx-target="#denied-logs-wrapper"
       hx-swap="outerHTML"
       hx-vals='{"page":1}'
       class="px-3 py-1 bg-zinc-800 border border-zinc-600 rounded text-xs text-white w-full md:max-w-xs md:ml-auto focus:outline-none focus:ring-1 focus:ring-purple-500" />
  </form>
</div>


  <!-- Wrapper -->
  {% include "partials/denied_logs_partial.html" %}
</div>

<script>
  document.addEventListener('htmx:afterSwap', function (e) {
    if (e.target.id === 'denied-logs-wrapper') {
      setTimeout(() => {
        const msgBox = document.getElementById("htmx-messages");
        if (msgBox) msgBox.innerHTML = '';
      }, 3000);
    }
  });
</script>


{% endblock %}

